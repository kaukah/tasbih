<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Tasbih Digital</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #fff;
      color: #1c1e21;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }
    #cover {
      position: absolute;
      inset: 0;
      background: linear-gradient(160deg, #007bff, #00c6ff);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 5;
    }
    #cover h1 { font-size: 2rem; margin-bottom: 20px; }
    #start-btn {
      padding: 12px 30px; font-size: 1.2rem; border: none; border-radius: 50px;
      background: white; color: #007bff; font-weight: 600; cursor: pointer; margin-top: 10px;
    }
    #vibrate-toggle { margin-top: 15px; display: flex; align-items: center; gap: 8px; }

    #tasbih-container {
      width: 100%; height: 100vh; display: none; flex-direction: column; justify-content: center; align-items: center;
      text-align: center; padding: 20px; box-sizing: border-box; z-index: 3; position: relative;
    }
    #dhikr-display { font-size: 1.5rem; font-weight: 600; color: #007bff; margin: 20px 0; z-index: 3; white-space: pre-line; }
    #count-display, #target-display {
  font-size: 1.5rem;
  color: #000;
  margin-bottom: 20px;
  z-index: 99; /* ‚¨ÖÔ∏è pastikan lebih tinggi dari #gold-fill dan #coin-img */
  position: relative;
}
    #count-display { margin-top: -10px; font-size: 9rem; font-weight: 600; }
    #target-display { font-size: 1.5rem; color: #6c757d; margin-bottom: 20px; }
    #reset-button {
      position: absolute; top: 10px; right: 10px; padding: 10px 25px; font-size: 1rem; font-weight: 600;
      color: #007bff; background-color: transparent; border: 2px solid #007bff; border-radius: 50px; cursor: pointer; z-index: 6;
    }

    /* === PROGRESS BAR: warna kuning + coin di atasnya === */
    #gold-fill {
      position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; pointer-events: none;
      background-color: #fef100; transition: height 0.4s ease; z-index: 1; /* di bawah konten */
    }
    #coin-img {
      position: absolute; left: 0; margin-bottom: -100px; width: 100%; pointer-events: none; height: auto; z-index: 2; /* di atas kuning */
      pointer-events: none; user-select: none; /* jangan ganggu tap */
      transition: bottom 0.4s ease;
      image-rendering: auto;
    }

    #confetti-emoji {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none;
      justify-content: center; align-items: center; font-size: 4rem; z-index: 4;
    }
    
    #stopwatch {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.2rem;
      font-weight: 600;
      color: #333;
      background: rgba(255,255,255,0.7);
      padding: 5px 10px;
      border-radius: 8px;
      z-index: 100;
    }

    .choice-btn {
      padding: 10px 20px;
      margin: 5px;
      font-size: 1.2rem;
      border: 2px solid #007bff;
      border-radius: 10px;
      background: white;
      color: #007bff;
      font-weight: 600;
      cursor: pointer;
    }

  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body>

  <div id="cover">
    <h1>‚ú® Alhamdulillah Profit 100 Juta Setiap Bulan ‚ú®</h1>
    <button id="start-btn">Gass üöÄ</button>
    <div id="vibrate-toggle">
      <input type="checkbox" id="vibrate-check" checked>
      <label for="vibrate-check">Bismillah</label>
    </div>
  </div>

  <div id="stopwatch">00:00</div>
  <div id="tasbih-container">
    <h2 id="dhikr-display">Subhanallah</h2>
    <div id="target-display">/ 33</div>
    <h1 id="count-display">1</h1>
    <button id="reset-button">Skip</button>
  </div>

  <div id="gold-fill"></div>
  <img id="coin-img" src="coin.png" alt="coins" />

  <div id="confetti-emoji">üëç</div>

  <script>
    const cover = document.getElementById('cover');
    const startBtn = document.getElementById('start-btn');
    const tasbihContainer = document.getElementById('tasbih-container');
    const dhikrDisplay = document.getElementById('dhikr-display');
    const countDisplay = document.getElementById('count-display');
    const targetDisplay = document.getElementById('target-display');
    const goldFill = document.getElementById('gold-fill');
    const coinImg = document.getElementById('coin-img');
    const resetButton = document.getElementById('reset-button');
    const confettiEmoji = document.getElementById('confetti-emoji');
    const vibrateCheck = document.getElementById('vibrate-check');

    const ding = new Audio('ding.mp3');

    const dhikrPhases = [
        { text: 'Tawasul:\n\n- ÿ•ŸêŸÑŸéŸâ ÿ≠Ÿéÿ∂Ÿíÿ±Ÿéÿ©Ÿê ÿßŸÑŸÜŸéŸëÿ®ŸêŸäŸêŸë ÿßŸÑŸíŸÖŸèÿµŸíÿ∑ŸéŸÅŸéŸâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸÖŸéŸëÿØŸç ÿµŸéŸÑŸéŸëŸâ ÿßŸÑŸÑŸáŸè ÿπŸéŸÑŸéŸäŸíŸáŸê ŸàŸéÿ≥ŸéŸÑŸéŸëŸÖŸé ŸàŸéÿßŸ∞ŸÑŸêŸáŸê ŸàŸéÿ£Ÿéÿ≤ŸíŸàŸéÿßÿ¨ŸêŸáŸê ŸàŸéÿ£ŸéŸàŸíŸÑŸéÿßÿØŸêŸáŸê ŸàŸéÿ∞Ÿèÿ±ŸêŸëŸäŸéŸëÿßÿ™ŸêŸáŸê ÿßŸÑŸíŸÅŸéŸÄŸÄÿßÿ™Ÿêÿ≠Ÿéÿ©Ÿè\n\n- ÿ´ŸèŸÖŸéŸë ÿ•ŸêŸÑŸéŸâ ÿ≠Ÿéÿ∂Ÿíÿ±Ÿéÿ©Ÿê ÿßŸêÿÆŸíŸàŸéÿßŸÜŸêŸáŸê ŸÖŸêŸÜŸé ÿßŸÑŸíÿ£ŸéŸÜŸíÿ®ŸêŸäŸéÿßÿ°ŸêŸàŸéÿßŸÑŸíŸÖŸèÿ±Ÿíÿ≥ŸéŸÑŸêŸäŸíŸÜŸé ŸàŸéÿßŸÑŸíÿ£ŸéŸàŸíŸÑŸêŸäŸéÿßÿ°Ÿê ŸàŸéÿßŸÑÿ¥ŸèŸëŸáŸéÿØŸéÿßÿ°Ÿê ŸàŸéÿßŸÑÿµŸéŸëÿßŸÑŸêÿ≠ŸêŸäŸíŸÜŸé ŸàŸéÿßŸÑÿµŸéŸëÿ≠Ÿéÿßÿ®Ÿéÿ©Ÿê ŸàŸéÿßŸÑÿ™ŸéŸëÿßÿ®ŸêÿπŸêŸäŸíŸÜŸé ŸàŸéÿßŸÑŸíÿπŸèŸÑŸéŸÖŸéÿßÿ°Ÿê ŸàŸéÿßŸÑŸíŸÖŸèÿµŸéŸÜŸêŸëŸÅŸêŸäŸíŸÜŸé ŸàŸéÿ¨ŸéŸÖŸêŸäŸíÿπŸê ÿßŸÑŸíŸÖŸéŸÑŸéÿßÿ¶ŸêŸÉŸéÿ©Ÿê ÿßŸÑŸíŸÖŸèŸÇŸéÿ±ŸéŸëÿ®ŸêŸäŸíŸÜŸé ÿÆŸèÿµŸèŸàŸíÿµŸãÿß ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ÿ¥ŸéŸäŸíÿÆŸê ÿπŸéÿ®ŸíÿØŸê ÿßŸÑŸíŸÇÿßÿØŸêÿ±Ÿê ÿßŸÑÿ¨ŸéŸäŸíŸÑŸéÿßŸÜŸêŸä ÿ±Ÿéÿ∂ŸêŸäŸé ÿßŸÑŸÑŸáŸè ÿπŸéŸÜŸíŸáŸè ‚Ä¶ÿßŸéŸÑŸíŸÅŸéÿßÿ™Ÿêÿ≠ŸéŸá', target: 0 },
        { text: 'Tawasul:\n\n ÿ•ŸêŸÑŸéŸâ ÿ≠Ÿéÿ∂Ÿíÿ±Ÿéÿ©Ÿê ŸÖŸíÿ®ŸéÿßŸáŸí ÿÆŸéŸÑŸêŸäŸíŸÑ ÿ®ŸéŸÜŸíŸÉŸéŸÑŸéÿßŸÜ\n\n- ŸàŸéÿ•ŸêŸÑŸéŸâ ÿ±ŸèŸàŸíÿ≠Ÿê ŸÖŸéŸÜŸí ÿ£Ÿéÿ¨Ÿéÿßÿ≤ŸéŸÜŸêŸä\n\n- ŸàŸéÿ•ŸêŸÑŸéŸâ ÿ£Ÿéÿ®ŸêŸä ŸàŸéÿ£ŸèŸÖŸêŸëŸä', target: 0 },
        { text: 'ÿßŸÑŸíŸÅŸéÿßÿ™Ÿêÿ≠Ÿéÿ©', target: 50 },
        { text: 'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ÿßŸÑŸíŸáŸéŸÖŸêŸë ŸàŸéÿßŸÑŸíÿ≠Ÿéÿ≤ŸéŸÜŸê ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ÿßŸÑŸíÿπŸéÿ¨Ÿíÿ≤Ÿê ŸàŸéÿßŸÑŸíŸÉŸéÿ≥ŸéŸÑŸê ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ÿßŸÑŸíÿ¨Ÿèÿ®ŸíŸÜŸê ŸàŸéÿßŸÑŸíÿ®ŸèÿÆŸíŸÑŸê ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ÿ∫ŸéŸÑŸéÿ®Ÿéÿ©Ÿê ÿßŸÑÿØŸéŸëŸäŸíŸÜŸê ŸàŸéŸÇŸéŸáŸíÿ±Ÿê ÿßŸÑÿ±ŸêŸëÿ¨ŸéÿßŸÑŸê', target: 3 },
        { text: 'ŸäŸéÿßŸÑŸéÿ∑ŸêŸäŸíŸÅŸè', target: 129 },
        { text: 'Ÿ±ŸÑŸÑŸéŸëŸáŸè ŸÑŸéÿ∑ŸêŸäŸÅŸå€¢ ÿ®ŸêÿπŸêÿ®ŸéÿßÿØŸêŸáŸê€¶ ŸäŸéÿ±Ÿíÿ≤ŸÇŸè ŸÖŸéŸÜ ŸäŸéÿ¥Ÿéÿ¢ÿ°Ÿè €ñ ŸàŸéŸáŸèŸàŸé Ÿ±ŸÑŸíŸÇŸéŸàŸêŸâŸèŸë Ÿ±ŸÑŸíÿπŸéÿ≤ŸêŸäÿ≤Ÿè', target: 7 },
        { text: 'ÿßŸéŸÑŸÑŸáŸèŸÖŸéŸë ÿßŸêŸÜŸêŸëŸâŸí ÿßŸéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸéŸÜŸí ÿ™Ÿéÿ±Ÿíÿ≤ŸèŸÇŸéŸÜŸêŸâŸí ÿ±Ÿêÿ≤ŸíŸÇŸãÿß ÿ≠ŸéŸÑÿßŸéŸÑÿßŸã ŸàŸéÿßÿ≥ŸêÿπŸãÿß ÿ∑ŸéŸäŸêŸëÿ®Ÿãÿß ŸÖŸêŸÜŸí ÿ∫ŸéŸäŸíÿ±Ÿê ÿ™ŸéÿπŸéÿ®Ÿç ŸàŸéŸÑÿßŸéŸÖŸéÿ¥ŸéŸÇŸéŸëÿ©Ÿç ŸàŸéŸÑÿßŸéÿ∂ŸéŸäŸíÿ±Ÿç ŸàŸéŸÑÿßŸéŸÜŸéÿµŸéÿ®Ÿç ÿßŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÑŸéŸâ ŸÉŸèŸÑŸêŸë ÿ¥ŸéŸâŸíÿ°Ÿç ŸÇŸéÿØŸêŸäŸíÿ±Ÿå', target: 3 },
        { text: 'ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ÿµŸéŸÑŸëŸê ÿπŸéŸÑŸéŸâ ÿ≥ŸéŸäŸëŸêÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸëŸéÿØŸç', target: 100 }
    ];

    let currentPhaseIndex = 0;
    let currentCount = 1;

    window.setTarget = function(value, ev) {
      if (ev) ev.stopPropagation();
      dhikrPhases[currentPhaseIndex].target = value;
      currentCount = 1;
      updateDisplay();
    }

    function updateProgress(percent){
      goldFill.style.height = percent + '%';
      coinImg.style.bottom = percent + '%';
    }

    function updateDisplay() {
      const phase = dhikrPhases[currentPhaseIndex];
      dhikrDisplay.textContent = phase.text;
      if (phase.targets) {
        let choices = phase.targets.map(t => 
          `<button class="choice-btn" onclick="setTarget(${t}, event)">${t}x</button>`
        ).join(" ");
        targetDisplay.innerHTML = choices;
        targetDisplay.style.display = "block";
        countDisplay.style.display = "none"; 
        updateProgress(0);
      } else if (phase.target > 0) {
        countDisplay.style.display = 'block';
        targetDisplay.style.display = 'block';
        countDisplay.textContent = currentCount;
        targetDisplay.textContent = `${phase.target}x`;
        const percent = (currentCount / phase.target) * 100;
        updateProgress(percent);
      } else {
        countDisplay.style.display = 'none';
        targetDisplay.style.display = 'none';
        updateProgress(0);
      }
    }

    function vibrate(ms) {
      if (vibrateCheck.checked && navigator.vibrate) navigator.vibrate(ms);
    }

    // --- FUNCTION UPDATED ---
    function handleTap() {
      const phase = dhikrPhases[currentPhaseIndex];

      if (phase.targets && !phase.target) {
        return;
      }

      if (phase.target === 0) {
        // For phases without a counter (like Tawasul)
        currentPhaseIndex++;
        currentCount = 1;
        smallConfetti();
      } else {
        // For phases with a counter
        if (currentCount < phase.target) {
          currentCount++;
          
          // Check if this tap reaches the target
          if (currentCount === phase.target) {
            // Target reached! Play sound and give strong vibration.
            vibrate([100, 50, 100]);
            try {
              ding.currentTime = 0;
              ding.play();
            } catch (e) {}
          } else {
            // Regular count, normal vibration
            vibrate(50);
          }
        } else {
          // If count is already at target, this tap transitions to the next phase
          if (currentPhaseIndex === dhikrPhases.length - 1) {
            showConfetti();
            return;
          } else {
            smallConfetti();
          }
          currentPhaseIndex++;
          currentCount = 1;
        }
      }
      updateDisplay();
    }
    // --- END OF UPDATE ---

    function smallConfetti(){
      confetti({ particleCount: 25, spread: 60, origin: { y: 0.7 }, colors: ['#FFD700','#00BFFF','#FF69B4'] });
    }

    function skipPhase(e) {
      e.stopPropagation();
      if (currentPhaseIndex < dhikrPhases.length - 1) {
        currentPhaseIndex++;
        currentCount = 1;
        updateDisplay();
      } else {
        showConfetti();
      }
    }

    function showConfetti(){
      stopStopwatch();
      let duration = 3000, end = Date.now() + duration;
      (function frame(){
        confetti({ particleCount: 30, spread: 90, origin: { y: 0.6 }, colors: ['#FFD700','#000000','#FFFFFF'] });
        confetti({ particleCount: 10, spread: 70, origin: { y: 0.6 }, shapes: ['text'], emojis: ['üëç'], scalar: 2 });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
      confettiEmoji.style.display = 'flex';
      setTimeout(() => { confettiEmoji.style.display = 'none'; cover.style.display = 'flex'; tasbihContainer.style.display = 'none'; }, duration + 1000);
    }

    let stopwatchInterval;
    let stopwatchStart;

    function startStopwatch() {
      stopwatchStart = Date.now();
      stopwatchInterval = setInterval(updateStopwatch, 1000);
    }

    function stopStopwatch() {
      clearInterval(stopwatchInterval);
    }

    function resetStopwatch() {
      clearInterval(stopwatchInterval);
      document.getElementById('stopwatch').textContent = "00:00";
    }

    function updateStopwatch() {
      const elapsed = Math.floor((Date.now() - stopwatchStart) / 1000);
      const minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
      const seconds = String(elapsed % 60).padStart(2, '0');
      document.getElementById('stopwatch').textContent = `${minutes}:${seconds}`;
    }

    startBtn.addEventListener('click', () => {
      cover.style.display = 'none';
      tasbihContainer.style.display = 'flex';
      currentPhaseIndex = 0;
      currentCount = 1;
      updateDisplay();
      resetStopwatch();
      startStopwatch();
    });

    tasbihContainer.addEventListener('click', handleTap);
    resetButton.addEventListener('click', skipPhase);
  </script>

</body>
</html>
